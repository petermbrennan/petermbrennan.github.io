"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),EditGallery=function(e){function t(e){_classCallCheck(this,t);var o=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.selectors=e,o.validatePhotoValues(),o.photoFields=o.topModal.find(".photo-field"),o.photoPreview=o.topModal.find(".photo-gallery-preview"),o.maxPhotos=o.photoFields.length,o.photoFields.on("change",function(e){o.renderPreview()}),o.renderPreview(),o}return _inherits(t,e),_createClass(t,[{key:"renderPreview",value:function(){var e=this;this.draggableContainer().html(""),this.photoFields.each(function(t,o){e.initPhoto(t,o)})}},{key:"initPhoto",value:function(e,t){var o=this.getPhotoData($(t),e),r="";r=o.url.length?this.initPhotoThumbnail(o,e):this.initPhotoPlaceholder(o,e),this.photoPreview.append(r)}},{key:"initPhotoThumbnail",value:function(e,t){var o=this.topWindow.$("<div class='photo photo-real' draggable='true' data-index='"+(t+1)+"'></div>"),r='<img src="'+e.url+'">',n="<i class='fa fa-remove'></i>";return o.html(r+n),o.data("photo",e),this.initPhotoClick(o),this.initPhotoRemove(o),this.makeDraggable(o),o}},{key:"initPhotoPlaceholder",value:function(e,t){var o=this.topWindow.$("<div class='photo photo-placeholder' data-index='"+(t+1)+"'><i class='fa fa-plus'></i></div>");return o.data("photo",e),this.initPhotoClick(o),o}},{key:"initPhotoClick",value:function(e){var t=this;e.on("click",function(e){var o=$(e.currentTarget).data("index"),r=t.topModal.find(".photo-field-"+o);return t.topModal.animate({scrollTop:r.position().top},200),!1})}},{key:"initPhotoRemove",value:function(e){var t=this;e.find(".fa-remove").on("click",function(e){var o=$(e.currentTarget).parent(".photo"),r=o.data("index"),n=t.topModal.find(".photo-field-"+r);return n.find(".form-field input[type=text]").each(function(e,t){$(t).val(""),$(t).trigger("change")}),t.renderPreview(),!1})}},{key:"draggableContainer",value:function(){return this.topModal.find(".photo-gallery-preview")}},{key:"draggableClass",value:function(){return".photo"}},{key:"draggableData",value:function(){return this.dragElem.data("photo")}},{key:"draggableObjects",value:function(){return this.topModal.find(".photo-real")}},{key:"afterDragDrop",value:function(){this.importGalleryJson(this.getGalleryJson())}},{key:"getGalleryJson",value:function(){return $.map(this.topModal.find(".photo"),function(e,t){return $(e).data("photo")})}},{key:"importGalleryJson",value:function(e){var t=this,o=this.photoValues(),r="string"==typeof e?JSON.parse(e):e;this.photoFields.each(function(e,n){var i=$(n),a=r[e];t.resetFields(i);var l=!0,u=!1,h=void 0;try{for(var c,s=Object.keys(o)[Symbol.iterator]();!(l=(c=s.next()).done);l=!0){var p=c.value;t.setValueOrEmpty(i,o[p],e,a[p])}}catch(f){u=!0,h=f}finally{try{!l&&s["return"]&&s["return"]()}finally{if(u)throw h}}}),this.renderPreview()}},{key:"getValueOrEmpty",value:function(e,t,o){var r=this.getSettingNameAndType(t,o),n=r.name,i=r.type,a=this.getFormField(e,n,i);return"checkbox"===i?!!a.length&&a.prop("checked"):a.length?a.val():""}},{key:"setValueOrEmpty",value:function(e,t,o,r){var n=this.getSettingNameAndType(t,o),i=n.name,a=n.type,l=this.getFormField(e,i,a);if(l.length)if("ckeditor"===a){var u=l.attr("id");this.topWindow.CKEDITOR.instances[u].setData(r)}else"checkbox"===a?l.prop("checked",r):l.val(r)}},{key:"resetFields",value:function(e){e.find("input[type=text], textarea").val(""),e.find("input[type=checkbox]").prop("checked",!1)}},{key:"getFormField",value:function(e,t,o){switch(o){case"ckeditor":case"textarea":return e.find(".form-field-"+t+" textarea");case"checkbox":return e.find(".form-field-"+t+" input[type=checkbox]");case"radio":return e.find(".form-field-"+t+" input[type=radio]:checked");default:return e.find(".form-field-"+t+" input[type=text]")}}},{key:"getSettingNameAndType",value:function(e,t){return{name:e.name.replace("X",t+1).replace(/_/g,"-"),type:e.type}}},{key:"getPhotoData",value:function(e,t){var o={},r=this.photoValues(),n=!0,i=!1,a=void 0;try{for(var l,u=Object.keys(r)[Symbol.iterator]();!(n=(l=u.next()).done);n=!0){var h=l.value;o[h]=this.getValueOrEmpty(e,r[h],t)}}catch(c){i=!0,a=c}finally{try{!n&&u["return"]&&u["return"]()}finally{if(i)throw a}}return o}},{key:"validatePhotoValues",value:function(){if(!this.photoValues().url)throw new Error("url must be defined in photoValue")}},{key:"photoValues",value:function(){throw new Error("photoValues not defined")}}]),t}(EditDraggable);