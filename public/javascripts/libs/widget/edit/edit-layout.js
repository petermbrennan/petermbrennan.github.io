"use strict";function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,a,i){return a&&t(e.prototype,a),i&&t(e,i),e}}(),EditWidgetModal=function(){function t(e,a,i){_classCallCheck(this,t),this.topModal=window.top.$(".modal-content"),this.widgetId=e,this.widgetName=a,this.rowWidgetId=i,this.setModal()}return _createClass(t,[{key:"setModal",value:function(){this.topModal.data("component").set("selectedWidgetName",this.widgetName),this.topModal.find(".heading").text("Edit "+this.widgetName)}}]),t}(),EditLayout=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.initDraggableObjects(),t.setSettingsList(),t.initLayoutWidgetModal(),t}return _inherits(e,t),_createClass(e,[{key:"layoutClass",value:function(t){return this.layoutClasses()[t]}},{key:"allLayoutClasses",value:function(){return this.layoutClasses()[0]}},{key:"getLayoutTag",value:function(){return"."+this.layoutTag()+"-widgets"}},{key:"initDraggableObjects",value:function(){var t=this;this.draggableObjects().each(function(e,a){var i=$(a);t.makeDraggable(i),t.initSelects(i)})}},{key:"openLayoutWidgetModal",value:function(t){this.editWidgetModal=new EditWidgetModal(t,null),this.editWidgetModal.getEditForm()}},{key:"initLayoutWidgetModal",value:function(){this.initChangeLayout(),this.updatePositions(!1),this.hideDraggableObjects(),this.hideSaveWarning(),this.showSelectedLayout()}},{key:"initChangeLayout",value:function(){var t=this;this.getSelectedLayout().on("change",function(e){t.showSaveWarning(),t.hideDraggableObjects(),t.hideEditLinks(),t.showSelectedLayout()})}},{key:"initSelects",value:function(t){var e=this;t.find("select").on("change",function(t){e.selectChanged($(t.currentTarget))})}},{key:"selectChanged",value:function(t){var e=t.val();t.find("option[selected]").removeAttr("selected"),t.find('option[value="'+e+'"]').attr("selected",!0),this.showSaveWarning(),this.hideEditLinks()}},{key:"initEditLinks",value:function(t){var e=this,a=this.topModal.find("."+this.layoutTag()+"-edit").data(this.layoutTag()+"-id");t.find(".edit-widget").on("click",function(t){var i=$(t.currentTarget);return e.editWidgetModal=new EditWidgetModal(i.data("widget-id"),i.data("widget-name"),a),e.editWidgetModal.getEditForm(),!1})}},{key:"afterDragDrop",value:function(){this.updatePositions(!0),this.showSaveWarning()}},{key:"draggableContainer",value:function(){return this.topModal.find(".layout-fields")}},{key:"draggableClass",value:function(){return this.getLayoutTag()}},{key:"draggableData",value:function(){return{index:this.dragElem.data("index")}}},{key:"draggableObjects",value:function(){return this.topModal.find(this.getLayoutTag())}},{key:"updatePositions",value:function(t){var e=this;this.draggableObjects().each(function(a,i){e.updatePosition(a,i,t)}),t&&this.transferSettings()}},{key:"updatePosition",value:function(t,e,a){var i=$(e),n=t+1,o=this.layoutTitle().toLowerCase()+"_"+n;i.removeClass(this.allLayoutClasses()).addClass(this.layoutClass(t)),i.attr("data-index",o).data("index",o),i.find("label").text(this.layoutTitle()+" "+n+" Widget"),a&&(i.hasClass("dropped")||(i.find(".edit-widget").hide(),i.find("select").material_select(),i.addClass("dropped")))}},{key:"setSettingsList",value:function(){var t=this;this.settingsList=[],this.draggableObjects().each(function(e,a){var i=$(a);t.settingsList.push({name:i.data("name"),id:i.data("id")})})}},{key:"transferSettings",value:function(){var t=this;this.draggableObjects().each(function(e,a){var i=$(a);i=t.transferSetting(i,"name",t.settingsList[e].name),i=t.transferSetting(i,"id",t.settingsList[e].id)}),this.setSettingsList()}},{key:"transferSetting",value:function(t,e,a){var i=t.data(e);t.attr("data-"+e,a).data(e,a);var n=t.html(),o=new RegExp(i,"g");return t.html(n.replace(o,a)),t}},{key:"getSelectedLayout",value:function(){return this.topModal.find("."+this.selectLayoutTag()+" select")}},{key:"showSelectedLayout",value:function(){var t=this.getSelectedLayout().val();$("."+t).show()}},{key:"hideDraggableObjects",value:function(){this.draggableObjects().hide()}},{key:"hideEditLinks",value:function(){this.topModal.find(".edit-widget").hide()}},{key:"hideSaveWarning",value:function(){this.topModal.find(".save-warning").removeClass("show")}},{key:"showSaveWarning",value:function(){this.topModal.find(".save-warning").addClass("show")}},{key:"selectLayoutTag",value:function(){throw new Error("selectLayoutTag not defined")}},{key:"layoutTag",value:function(){throw new Error("layoutTag not defined")}},{key:"layoutTitle",value:function(){throw new Error("layoutTitle not defined")}},{key:"layoutClasses",value:function(){throw new Error("layoutClasses not defined")}}]),e}(EditDraggable);