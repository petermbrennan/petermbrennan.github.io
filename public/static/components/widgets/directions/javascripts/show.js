(function(){var t;t=function(){function t(t){this.config=t,this.widget=$(".directions"),this.initWidgetComponents(),this.override=this.config.overrides,this.resize(),this.submit.on("click",function(t){return function(){return t.calcRoute()}}(this)),$(window).on("resize orientationchange",function(t){return function(){return t.resize()}}(this)),G5.googleMapsApi.registerWidget(this,"getDirectionsCoords")}return t.prototype.config=null,t.prototype.wideWidth=960,t.prototype.smallWidth=480,t.prototype.storeCoords=null,t.prototype.lat=null,t.prototype.lng=null,t.prototype.directionsDisplay=null,t.prototype.initWidgetComponents=function(){return this.input=this.widget.find(".directions-start"),this.wrapper=this.input.parent(".text"),this.submit=this.wrapper.find(".directions-submit"),this.canvas=this.widget.find(".canvas"),this.panel=this.widget.find(".panel"),this.error=this.widget.find(".directions-error")},t.prototype.getDirectionsCoords=function(){return this.getClientCoords(),this.getStoreCoords()},t.prototype.resize=function(){return this.widget.parents("div").width()>=this.wideWidth?this.widget.addClass("wide"):this.widget.removeClass("wide"),this.widget.parents("div").width()<this.smallWidth?this.widget.addClass("small"):this.widget.removeClass("small"),this.input.css({width:this.wrapper.width()-this.submit.outerWidth(!0)-15})},t.prototype.setupMap=function(){var t,e,o,r;return this.directionsDisplay=new google.maps.DirectionsRenderer,o={zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,center:this.storeCoords},t=new google.maps.Map(this.canvas[0],o),this.directionsDisplay.setMap(t),this.directionsDisplay.setPanel(this.panel[0]),"true"===this.override.suppress_info_windows&&this.directionsDisplay.setOptions({suppressInfoWindows:!0}),e={position:this.storeCoords,map:t,title:this.config.address},r=new google.maps.Marker(e)},t.prototype.getStoreCoordsLatLng=function(){return this.storeCoords=new google.maps.LatLng(parseFloat(this.config.lat),parseFloat(this.config.lon)),this.setupMap()},t.prototype.getStoreCoordsAddress=function(){var t,e;return t=this.config.address,e=new google.maps.Geocoder,e.geocode({address:t},function(t){return function(e,o){return o===google.maps.GeocoderStatus.OK?(t.storeCoords=e[0].geometry.location,t.storeAddress=e[0].formatted_address,t.setupMap()):t.invalidStoreAddressError()}}(this))},t.prototype.getStoreCoordsGeocode=function(){return $.getJSON(G5.googleMapsApi.geocodeUrl(),{address:this.config.address,sensor:"false"}).done(function(t){return function(e){return e.results.length?(t.lat=e.results[0].geometry.location.lat,t.lng=e.results[0].geometry.location.lng,t.storeCoords=new google.maps.LatLng(t.lat,t.lng),t.setupMap()):t.invalidStoreAddressError()}}(this))},t.prototype.getStoreCoords=function(){return"true"===this.override.hardcodeLatLon?this.getStoreCoordsLatLng():"address"===this.override.hardcodeLatLon?this.getStoreCoordsAddress():this.getStoreCoordsGeocode()},t.prototype.getClientCoords=function(){var t,e,o;if(o=void 0,e=window.navigator,null!=e)return t=e.geolocation,o=t.getCurrentPosition(function(t){return function(e){return t.successCallback(e)}}(this),function(t){return function(e){return 0===e.message.indexOf("Only secure origins are allowed")||0===e.message.indexOf("User denied Geolocation")?t.nonSecureError(e):t.errorCallback(e)}}(this))},t.prototype.successCallback=function(t){var e;return e=new google.maps.LatLng(t.coords.latitude,t.coords.longitude),this.populateStartAddress(e)},t.prototype.errorCallback=function(t){return this.showErrorMessage("Physical location for the starting address not found"),console.log("error detecting physical location")},t.prototype.nonSecureError=function(t){return this.showErrorMessage(""),console.log("google maps only secure origins are allowed")},t.prototype.showErrorMessage=function(t){if(t.length)return this.error.html(t).addClass("show")},t.prototype.hideErrorMessage=function(){return this.error.removeClass("show")},t.prototype.populateStartAddress=function(t){var e,o;return e=void 0,o=new google.maps.Geocoder,o.geocode({latLng:t},function(t){return function(o,r){if(r===google.maps.GeocoderStatus.OK)return e=o[0].formatted_address,t.input.attr("value",e),t.calcRoute()}}(this))},t.prototype.calcRoute=function(){var t,e,o,r;return this.storeCoords?(this.hideErrorMessage(),this.submit.addClass("disabled").prop("disabled",!0),t=new google.maps.DirectionsService,r=this.input.val(),e="address"===this.override.hardcodeLatLon?this.storeAddress:this.storeCoords,o={origin:r,destination:e,travelMode:google.maps.TravelMode.DRIVING},t.route(o,function(t){return function(e,o){return o===google.maps.DirectionsStatus.OK?t.directionsDisplay.setDirections(e):t.showErrorMessage("No directions found. Try a different address."),t.submit.removeClass("disabled").prop("disabled",!1)}}(this))):this.invalidStoreAddressError()},t.prototype.invalidStoreAddressError=function(){return this.showErrorMessage("The Store address for this Directions Widget is not set up correctly"),this.submit.addClass("disabled").prop("disabled",!0),this.canvas.hide(),this.panel.hide()},t}(),G5.loadWidgetConfigs(".directions .config",t)}).call(this);