"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}}(),MultifamilyIuiHomeV2Widget=function(){function e(n){var t=this;_classCallCheck(this,e),Object.assign(this,{configs:n,widget:$("#"+n.widgetId)}),this.fetchInventory().done(function(e){t.inventory=e;var n=e.floorplan_groups;t.createFloorplanGroupClickEvents(t.buildMarkup(n)),t.listenForPhoneNumberService()})}return _createClass(e,[{key:"fetchInventory",value:function(){var e=this.configs,n=e.floorplans_service_host,t=e.location_urn;return $.ajax({url:n+"/api/v1/apartment_complexes/"+t+"/floorplans",dataType:"json"})}},{key:"listenForPhoneNumberService",value:function(){var e=this,n=this.configs,t=n.widgetId,a=n.client_urn,i=n.location_urn,o=n.cpns_url;t="#"+t,new PhoneNumber({clientUrn:a,locationUrn:i,cpnsUrl:o},t),$(t).on("phoneNumbersReady",function(){e.replacePhoneNumbers(t)})}},{key:"replacePhoneNumbers",value:function(){var e=this.configs.location_urn,n=window,t=n.g5PhoneList;if(t&&t.numbers[e].phone_number){var a=t.numbers[e].phone_number,i=/\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})/;a=a.replace(/\D/g,""),a=a.split(""),a.splice(3,0,"-"),a.splice(7,0,"-"),a=a.join(""),this.widget.find("[data-category].phone").each(function(e,n){var t=$(n),o=t.text();o&&a&&o.match(i)&&(o=o.replace(i,'<div style="white-space: nowrap;">'+a+"</div>"),t.html(o),t.attr("href","tel:"+a))})}}},{key:"buildMarkup",value:function(e){var n=this,t=this.configs.floorplan_page_url,a=e.map(function(e){return n.buttonTemplate(e)}),i="<div class='iui-size iui-view-all'>\n                          <a class='btn' href='"+t+"/#/categories/all/floorplans'>\n                          View All\n                          </a>\n                        </div>";return a.push(i),this.widget.addClass("count-"+e.length).find(".iui-container").html(a.join(""))}},{key:"buttonTemplate",value:function(e){var n=this.configs.floorplan_page_url,t=e.id,a=e.description,i=e.call_to_action_id,o=this.hasFloorplans(e);return"<div class='iui-size "+(i?"has-cta":"")+" "+(o?"":"empty")+"'>\n             <a class='btn btn-beds' "+(i?"":"href='"+n+"/#/categories/"+t+"/floorplans'")+">\n               "+a+"\n             </a>\n             "+(i?this.ctaTemplate(i,e,o):"")+"\n           </div>"}},{key:"ctaTemplate",value:function(e,n,t){var a=this.inventory.call_to_actions.filter(function(n){return n.id===e}).pop(),i=n.id,o=n.empty_group_label,r=a.action_type,l=a.is_external,s=a.url,c=a.name;return'<div class="dropdown-content">\n                <span>'+o+'</span>\n                <a data-category="'+i+'" '+("call"==r||l?'href="'+s+"\" class='phone'":"class='form'")+" "+(l?'target="_blank"':"")+">"+c+"</a>\n              </div>"}},{key:"createFloorplanGroupClickEvents",value:function(e){var n=this,t=new MultifamilyIuiHomeV2Modal(widget);e.find(".has-cta").click(function(e){var t=e.currentTarget,a=e.target;$(a).hasClass("dropdown-content")||($(t).hasClass("active")?$(t).removeClass("active"):(n.widget.find(".has-cta").removeClass("active"),$(t).addClass("active")))}),e.find("[data-category].form").click(function(e){var a=e.currentTarget,i=$(a).data(),o=i.category,r=n.inventory,l=r.floorplan_groups,s=r.call_to_actions,c=l.filter(function(e){return e.id===o}).pop(),u=s.filter(function(e){return e.id===c.call_to_action_id}).pop();t.open(u)}),$(window).click(function(n){var t=n.target;return $(t).parent().hasClass("iui-size")||$(t).hasClass("dropdown-content")?null:e.find(".has-cta").removeClass("active")})}},{key:"hasFloorplans",value:function(e){return!!this.inventory.floorplans.filter(function(n){return n.floorplan_group_ids.includes(e.id)}).length}}]),e}(),MultifamilyIuiHomeV2Modal=function(){function e(n){_classCallCheck(this,e),Object.assign(this,{widget:n})}return _createClass(e,[{key:"open",value:function(e){this.displayModal(),this.attachForm(e)}},{key:"close",value:function(){this.removeModal()}},{key:"displayModal",value:function(){var e=$('<div id="mf-search-v2-modal-wrapper" class="modal">\n                                    <div id="modal-content">\n                                      <span id="close">&times;</span>\n                                      <div class="mf-home-v2-form" id="form">\n                                      </div>\n                                    </div>\n                                  </div>');$("body").append(e),this.modalEvents(e)}},{key:"removeModal",value:function(){$("#mf-search-v2-modal-wrapper").remove()}},{key:"modalEvents",value:function(e){var n=this;e.find("#close").click(function(){return n.close()}),$(window).click(function(t){var a=t.target;return a==e[0]?n.close():null})}},{key:"attachForm",value:function(e){var n=this.buildSubmissionOptions(e);G5Leads&&G5Leads.g5FormEnhancer?G5Leads.g5FormEnhancer(n):console.error("Missing G5Leads JS to enhance form with CTA: "+e)}},{key:"buildSubmissionOptions",value:function(e){var n={formUrl:e.url,enhanceClass:"mf-home-v2-form"};return e.redirect_url&&(n.successRedirectUrl=e.redirect_url),n}}]),e}();G5.loadWidgetConfigs(".home-multifamily-iui-v2 .config",MultifamilyIuiHomeV2Widget);