"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),MultifamilyMiniSearchV2Widget=function(){function e(t){_classCallCheck(this,e),this.configs=t,this.widget=$("#"+this.configs.widgetId),this.primarySearch()}return _createClass(e,[{key:"primarySearch",value:function(){var e=this;return $.ajax({url:this.configs.serviceURL+"/api/v1/client_location_data/"+this.configs.clientURN,dataType:"json",success:function(t){e.setCountry(t.countries),t.states.sort(function(e,t){return e.name_abbr<t.name_abbr?-1:1}),t.cities.sort(function(e,t){return e.name<t.name?-1:1}),new corpSearchMarkupBuilder(t,e.configs),"true"===e.configs.useUniversalSearch?(e.universalSearch(t),e.typeAheadChange(),e.keyUp(),e.widget.find(".search-fields").css({overflow:"visible"}),e.widget.find(".searh-input").css({padding:"0.5em 1em"}),e.widget.find(".search-form").css({height:"200px"})):e.widget.find(".mf-search-go-button.default-submit-button").on("click",function(){return new searchSubmittal(t,e.configs)})}})}},{key:"setCountry",value:function(e){var t=this.widget.find("select.mf-search-states.default-select"),i=t.find("option").first(),a=this.widget.find(".mf-search-input");1===e.length&&"CA"==e[0].name?(i.text("Province"),a.attr("placeholder","Search by City, Province, or Postal Code")):2===e.length?(i.text("State or Province"),a.attr("placeholder","Search by City, State/Province, or Zip/Postal Code")):a.attr("placeholder","Search by City, State, or Zip")}},{key:"createHref",value:function(e){var t="//"+(window.location.host+this.configs.corpSearchPage);t+=e.length?"#/locations?amenities="+e.join(""):"",this.widget.find(".mf-search-go-button.default-submit-button").on("click",function(){window.location=t})}},{key:"universalSearch",value:function(e){this.states=e.states,this.cities=e.cities,this.postalCodes=e.postal_codes,this.brandedNames=e.branded_names,this.searchCriteria={};var t=[],i=!0,a=!1,n=void 0;try{for(var r,s=e.states[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var c=r.value;t.push({loc:c.name}),this.searchCriteria[c.name]="state";var o=!0,l=!1,u=void 0;try{for(var h,d=c.cities[Symbol.iterator]();!(o=(h=d.next()).done);o=!0){var f=h.value,p=e.cities.filter(function(e){return e.id===f}),m=p[0].name,g=m+", "+c.name;this.searchCriteria[g]="city state",t.push({loc:g})}}catch(y){l=!0,u=y}finally{try{!o&&d["return"]&&d["return"]()}finally{if(l)throw u}}}}catch(y){a=!0,n=y}finally{try{!i&&s["return"]&&s["return"]()}finally{if(a)throw n}}var v=!0,w=!1,b=void 0;try{for(var C,k=this.postalCodes[Symbol.iterator]();!(v=(C=k.next()).done);v=!0){var S=C.value;this.searchCriteria[S.postal_code]="postal code",t.push({loc:S.postal_code,code:S.postal_code})}}catch(y){w=!0,b=y}finally{try{!v&&k["return"]&&k["return"]()}finally{if(w)throw b}}var _=!0,P=!1,x=void 0;try{for(var B,U=this.brandedNames[Symbol.iterator]();!(_=(B=U.next()).done);_=!0){var I=B.value;this.searchCriteria[I.name]="branded name",t.push({loc:I.name,name:I.name})}}catch(y){P=!0,x=y}finally{try{!_&&U["return"]&&U["return"]()}finally{if(P)throw x}}var M={autoselect:!0,minLength:1,highlight:!0},T=new Bloodhound({local:t,identify:function(e){return e.loc},datumTokenizer:Bloodhound.tokenizers.obj.whitespace("loc"),queryTokenizer:Bloodhound.tokenizers.whitespace});e={name:"typeaheadData",source:function(e,t){return""===e?t(T.local):T.search(e,t)},display:"loc",limit:100},this.createHref([]),this.widget.find(".mf-search-input").typeahead(M,e)}},{key:"typeAheadChange",value:function(){var e=this;this.widget.find(".mf-search-input").on("typeahead:selected typeahead:autocompleted typeahead:cursorchange typeahead:close",function(t){e.typeaheadCurrentVal=t.target.value;var i=[],a=$(t.currentTarget).typeahead("val"),n=e.searchCriteria[$(t.currentTarget).typeahead("val")];switch(n){case"state":var r=e.states.filter(function(e){return e.name===a})[0].name_abbr;i.push("&state="+escape(r));break;case"city state":var s=e.cities.filter(function(e){return a.includes(e.name)})[0].name,r=e.states.filter(function(e){return a.includes(e.name)})[0].name_abbr;i.push("&state="+escape(r),"&city="+escape(s));break;case"postal code":i.push("&postalCode="+escape(a));break;case"branded name":var c=e.brandedNames.filter(function(e){return e.name===a})[0].name;i.push("&brandedName="+escape(c))}e.createHref(i)})}},{key:"keyUp",value:function(){var e=this;return this.widget.find(".mf-search-input").on("keyup",function(t){var i=e.widget.find(".mf-search-input").siblings(".tt-menu"),a=i.find(".tt-suggestion");return 0===a.length?(13===t.which&&e.widget.find(".mf-search-go-button").click(),!1):(13===t.which&&(e.typeaheadCurrentVal||a.first().click(),e.widget.find(".mf-search-go-button").click()),void(27===t.which&&(e.widget.find(".mf-search-input").blur(),e.widget.find(".mf-search-input").typeahead("val",""),e.createHref([]))))})}}]),e}(),corpSearchMarkupBuilder=function e(t,i){_classCallCheck(this,e),this.configs=i,this.widget=$("#"+this.configs.widgetId);var a=this.widget.find("select.mf-search-states.default-select"),n=this.widget.find("select.mf-search-cities.default-select"),r=[];t.states.forEach(function(e){return r.push({name:e.name_abbr,id:e.id})}),new optionsBuilder(r,a),a.change(function(){return new citySelectUpdater(t,a,n)})},citySelectUpdater=function t(e,i,a){_classCallCheck(this,t),a.html("<option value=''>City</option>");var n=i.val(),r=e.cities.filter(function(e){return e.state_id===parseInt(n,10)});new optionsBuilder(r,a)},optionsBuilder=function i(e,t){_classCallCheck(this,i);var a=e.reduce(function(e,t){return e+"<option value='"+t.id+"'>"+t.name+"</option>"},"");t.append(a)},searchSubmittal=function a(e,t){_classCallCheck(this,a),this.configs=t,this.widget=$("#"+this.configs.widgetId);var i=this.widget.find("select.mf-search-states.default-select").val(),n=this.widget.find("select.mf-search-cities.default-select").val()||this.widget.find("select.mf-search-cities.default-select").data().id,r=e.states.filter(function(e){return e.id===parseInt(i,10)}),s="undefined"!=typeof r[0]?"&state="+r[0].name_abbr:"",c=e.cities.filter(function(e){return e.id===parseInt(n,10)}),o="undefined"!=typeof c[0]?"&city="+c[0].name:"",l="#/locations?page=1"+s+o;window.location="//"+window.location.host+this.configs.corpSearchPage+l};G5.loadWidgetConfigs(".multifamily-mini-search-v2 .config",MultifamilyMiniSearchV2Widget);