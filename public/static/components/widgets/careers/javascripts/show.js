"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function _asyncToGenerator(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){function i(s,a){try{var r=e[s](a),o=r.value}catch(c){return void n(c)}return r.done?void t(o):Promise.resolve(o).then(function(t){i("next",t)},function(t){i("throw",t)})}return i("next")})}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),CareersWidget=function(){function t(e){var n=this;_classCallCheck(this,t),Object.assign(this,{SMALL:480,LARGE:980,XLARGE:1170,configs:e}),G5.fortAwesomeApi.registerWidget(this,"fortAwesomeLoaded"),this.clientName=encodeURIComponent('"'+this.configs.clientName+'"'),this.channel=encodeURIComponent(this.configs.channel),this.widgetId=this.configs.widgetId,this.widget=$("#"+this.widgetId),this.path=location.protocol+"//"+location.host+location.pathname+"?page=",this.start=this.startPage(this.currentPage()),this.clientNameVar=this.configs.clientNameVar,this.clientNameStr=decodeURI(this.clientName).replace(/"/g,""),this.popped="state"in window.history&&null!==window.history.state,this.initialURL=location.href,this.setResize(),this.showWidget(),this.collectPosts().then(function(t){var e=t.posts,i=t.totalResults;n.addPosts(e,i),n.bindSortingEvent()})}return _createClass(t,[{key:"collectPosts",value:function(){function t(){return e.apply(this,arguments)}var e=_asyncToGenerator(regeneratorRuntime.mark(function n(){var t,e,i,s,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t=this.buildSearchURLs(1)[0],n.next=3,this.requestPosts(t);case 3:if(e=n.sent,i=e.posts,s=e.totalResults,!(i.length<s)){n.next=22;break}a=this.buildSearchURLs(s),a.pop();case 9:if(!(t=a.pop())){n.next=22;break}return n.next=12,new Promise(function(t){return setTimeout(function(){t()},750)});case 12:return n.t0=i.push,n.t1=i,n.t2=_toConsumableArray,n.next=17,this.requestPosts(t);case 17:n.t3=n.sent.posts,n.t4=(0,n.t2)(n.t3),n.t0.apply.call(n.t0,n.t1,n.t4),n.next=9;break;case 22:return n.abrupt("return",{posts:i,totalResults:s});case 23:case"end":return n.stop()}},n,this)}));return t}()},{key:"requestPosts",value:function(){function t(t){return e.apply(this,arguments)}var e=_asyncToGenerator(regeneratorRuntime.mark(function n(t){var e,i,s,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,fetch(t);case 2:return e=n.sent,n.next=5,e.json();case 5:return i=n.sent,s=i.results,a=i.totalResults,n.abrupt("return",{posts:s,totalResults:a});case 9:case"end":return n.stop()}},n,this)}));return t}()},{key:"addPosts",value:function(t,e){t&&t.length?(t=this.createPostsFormattedDate(t),this.posts=this.sortPosts(t,this.configs.sortBy),this.verifyPosts(t),this.buildMarkup(this.currentPage()),e=t.length,this.simplePagination(e)):this.searchFailed("No posts found")}},{key:"verifyPosts",value:function(t){for(var e=t.map(function(t){return t.company.toLowerCase()}),n=([].concat(_toConsumableArray(new Set(e))),e.length),i=this.clientNameStr.toLowerCase(),s=n-1;s>=0;s--){var a=e[s];(a!=i&&"false"===this.clientNameVar||!e[s].includes(i)&&"true"===this.clientNameVar)&&(e.splice(s,1),t.splice(s,1))}}},{key:"sortPosts",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return t.sort(function(t,i){var s=t[e],a=i[e];return s<a?n?-1:1:s>a?n?1:-1:0})}},{key:"createPostsFormattedDate",value:function(t){return t.map(function(t){var e=new Date(t.date);return Object.assign(t,{date:e.getTime(),formattedDate:moment(e).format("MM/DD/YYYY"),stateCity:t.state+t.city})})}},{key:"searchFailed",value:function(){var t;(t=console).error.apply(t,["There was an error fetching post results"].concat(Array.prototype.slice.call(arguments))),this.errorMessage("No job listings were found")}},{key:"buildSearchURLs",value:function(t){for(var e=[],n=this.configs.indeedApi+"?format=json&",i=25,s=Math.ceil(t/i);s;s--){var a="publisher="+this.configs.publisherId+"&q=company:"+this.clientName+"&chnl="+this.channel+"&limit="+i+"&start="+(s-1)*i+"&v=2&highlight=0",r=encodeURIComponent(n+a),o=this.configs.apiProxy+r;e.push(o)}return e}},{key:"errorMessage",value:function(t){t=t||"We're having trouble displaying the job listings. Please try again later",this.widget.find(".posts").append('<li class="post error">'+t+"</li>")}},{key:"startPage",value:function(t){return(t-1)*this.configs.pageLimit}},{key:"simplePagination",value:function(t){var e=this;this.widget.append('<div class="careers-pagination"></div>'),this.widget.find(".careers-pagination").pagination({items:t,itemsOnPage:this.configs.pageLimit,currentPage:this.currentPage(),edges:1,prevText:"&laquo;",nextText:"&raquo;",hrefTextPrefix:this.path,onPageClick:function(t,n){n&&n.preventDefault(),e.paginationPageClick(t)},onInit:function(){e.historyHandler()}})}},{key:"paginationPageClick",value:function(t){this.scrollToWidget();var e=(this.startPage(t),this.path+t);this.buildMarkup(t),history.pushState&&history.pushState({page:t},e,e)}},{key:"currentPage",value:function(){return parseInt(this.getUrlParameter("page"))||1}},{key:"historyHandler",value:function(){var t=this;$(window).on("popstate",function(e){var n=!t.popped&&location.href===t.initialURL;if(t.popped=!0,n)return void t.widget.find(".careers-pagination").pagination("drawPage",t.currentPage());t.scrollToWidget();var i=null===e.originalEvent.state?1:e.originalEvent.state.page;t.buildMarkup(i),t.widget.find(".careers-pagination").pagination("drawPage",i)})}},{key:"buildMarkup",value:function(t){var e=this,n=this.configs,i=n.pageLimit,s=n.clientName,a=this.posts.slice((t-1)*i,t*i);if(a.length>0)var r=a[0],o=r.company,c="false"===this.clientNameVar?o.toLowerCase()===s.toLowerCase():o,l=a.filter(function(t){return c}),h=l.length>0?l.map(function(t){return e.postTemplate(t)}):[];this.widget.find(".posts").html(h.join(""));var u=window.location.href;window.location.hash&&(u=u.replace(window.location.hash,"")),$.each(this.widget.find("use"),function(){$(this).attr("xlink:href",u+$(this).attr("xlink:href"))})}},{key:"postTemplate",value:function(t){return'<li class="post">\n                    <div class="post-posted post-item">\n                      <h4>'+t.formattedDate+'</h4>\n                    </div>\n                    <div class="post-info post-item">\n                      <h4 class="post-org post-item">\n                        <span>'+t.company+'</span>\n                      </h4>\n                      <h4 class="post-title post-item"><a href="'+t.url+'" target="_blank">'+t.jobtitle+'</a></h4>\n                      <h4 class="post-location post-item">\n                        <span>\n                          <span>'+t.city+"</span>, <span>"+t.state+'</span>\n                        </span>\n                      </h4>\n                      <p class="post-description post-item">'+t.snippet+'</p>\n                    </div>\n                    <div class="post-actions post-item">\n                      <a href="'+t.url+'" class="post-btn btn" target="_blank">\n                      <svg class="icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#'+this.widgetId+'-icon" /></svg>\n                      View Job Post</a>\n                    </div>\n                  </li>'}},{key:"setResize",value:function(){var t=this;$(window).smartresize(function(){return t.resize()}),this.resize()}},{key:"resize",value:function(){this.widget.toggleClass("careers-small",this.widget.width()>=this.SMALL),this.widget.toggleClass("careers-large",this.widget.width()>=this.LARGE),this.widget.toggleClass("careers-xlarge",this.widget.width()>=this.XLARGE)}},{key:"showWidget",value:function(){this.widget.find(".careers-wrapper").fadeIn("slow")}},{key:"bindSortingEvent",value:function(){var t=this;this.widget.find("[data-sort]").click(function(e){var n=$(e.currentTarget);n.hasClass("active")?(n.toggleClass("descending"),n.hasClass("descending")?t.widget.find(".active .fa").removeClass("fa-chevron-right fa-chevron-down").addClass("fa-chevron-up"):t.widget.find(".active .fa").removeClass("fa-chevron-right fa-chevron-up").addClass("fa-chevron-down")):(t.widget.find(".careers-pagination").pagination("selectPage",1),t.widget.find("[data-sort]").removeClass("active ascending descending"),n.addClass("active"),t.widget.find("[data-sort] .fa").removeClass("fa-chevron-up fa-chevron-down").addClass("fa-chevron-right"),t.widget.find(".active .fa").removeClass("fa-chevron-right fa-chevron-up").addClass("fa-chevron-down")),t.posts=t.sortPosts(t.posts,n.data("sort"),!n.hasClass("descending")),t.buildMarkup(t.currentPage())}),this.widget.find("[data-sort="+this.configs.sortBy+"]").addClass("active")}},{key:"scrollToWidget",value:function(){$("html, body").animate({scrollTop:this.widget.offset().top-50},500)}},{key:"getUrlParameter",value:function(t){var e=window.location.href,n=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return n?n[1]:void 0}}]),t}();G5.loadWidgetConfigs(".careers .config",CareersWidget);